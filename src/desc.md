
## 1. Загальна структура бази даних

База даних моделює систему **замовлення авіаквитків**.
У ній виділено такі основні сутності:

1. **Клієнти системи** – хто робить замовлення (`customers`)
2. **Пасажири** – ті, хто реально летить (`passengers`)
3. **Авіакомпанії** (`airlines`)
4. **Аеропорти** (`airports`)
5. **Рейси** (`flights`)
6. **Бронювання (замовлення)** (`bookings`)
7. **Квитки** (`tickets`)
8. **Платежі** (`payments`)

Між ними побудовані зв’язки через **первинні ключі (PK)** та **зовнішні ключі (FK)**.
Це забезпечує логічну цілісність даних та нормалізацію.

---

## 2. Опис таблиць і їхніх полів

### 2.1. Таблиця `customers` – клієнти системи

Зберігає інформацію про користувачів, які оформлюють замовлення.

* **Основні поля:**

  * `customer_id` – унікальний ідентифікатор клієнта (первинний ключ).
  * `first_name`, `last_name` – ім'я та прізвище.
  * `email` – електронна пошта (є унікальною).
  * `phone` – телефон.
  * `date_of_birth` – дата народження.
  * `nationality` – громадянство.

**Обмеження:**

* `customer_id` – первинний ключ (PK).
* `email` – унікальне значення (UNIQUE), щоб не було двох акаунтів з однією поштою.

---

### 2.2. Таблиця `passengers` – пасажири

Окремо від клієнта, бо один клієнт може купувати квитки для кількох пасажирів (себе, родичів і т.д.).

* **Основні поля:**

  * `passenger_id` – унікальний ідентифікатор пасажира (PK).
  * `customer_id` – посилання на клієнта (FK → `customers`).
  * `first_name`, `last_name` – ім'я та прізвище пасажира.
  * `date_of_birth` – дата народження.
  * `passport_number` – номер паспорта.
  * `nationality` – громадянство.

**Обмеження:**

* `passenger_id` – первинний ключ.
* `customer_id` – зовнішній ключ на `customers.customer_id`.

  * При видаленні клієнта – його пасажири теж видаляються (ON DELETE CASCADE).
  * При зміні ID клієнта – оновлюється у пасажирів (ON UPDATE CASCADE).

---

### 2.3. Таблиця `airlines` – авіакомпанії

Містить список авіакомпаній.

* **Основні поля:**

  * `airline_id` – унікальний ідентифікатор (PK).
  * `name` – назва авіакомпанії.
  * `iata_code` – 2-літерний код IATA (наприклад, PS).
  * `icao_code` – 3-літерний код ICAO.
  * `country` – країна.

**Обмеження:**

* `airline_id` – PK.
* `iata_code` – UNIQUE.
* `icao_code` – UNIQUE.

Тобто в БД не може бути двох авіакомпаній з однаковим IATA або ICAO кодом.

---

### 2.4. Таблиця `airports` – аеропорти

Зберігає інформацію про аеропорти.

* **Основні поля:**

  * `airport_id` – унікальний ідентифікатор (PK).
  * `name` – назва аеропорту.
  * `iata_code` – 3-літерний код аеропорту.
  * `city` – місто.
  * `country` – країна.
  * `time_zone` – часовий пояс.

**Обмеження:**

* `airport_id` – PK.
* `iata_code` – UNIQUE (двох аеропортів з однаковим кодом бути не може).

---

### 2.5. Таблиця `flights` – рейси

Описує конкретні вильоти.

* **Основні поля:**

  * `flight_id` – унікальний ID рейсу (PK).
  * `airline_id` – FK на авіакомпанію.
  * `flight_number` – номер рейсу (наприклад, PS101).
  * `departure_airport_id` – FK на аеропорт вильоту.
  * `arrival_airport_id` – FK на аеропорт прильоту.
  * `departure_time` – дата і час вильоту.
  * `arrival_time` – дата і час прильоту.
  * `base_price` – базова ціна квитка.
  * `status` – статус рейсу (запланований, затриманий, скасований тощо).

**Обмеження:**

* `flight_id` – PK.
* `airline_id` – FK → `airlines.airline_id`.
* `departure_airport_id` – FK → `airports.airport_id`.
* `arrival_airport_id` – FK → `airports.airport_id`.
* Перевірка (`CHECK`), що аеропорт вильоту і прильоту не однакові.
* Унікальність комбінації:

  * `(airline_id, flight_number, departure_time)` – не можна мати два однакових рейси однієї авіакомпанії з тим самим номером і тим самим часом вильоту.

---

### 2.6. Таблиця `bookings` – бронювання (замовлення)

Відповідає одному оформленому замовленню.

* **Основні поля:**

  * `booking_id` – унікальний ID бронювання (PK).
  * `customer_id` – FK на клієнта.
  * `booking_date` – дата і час створення бронювання.
  * `status` – статус замовлення (наприклад, pending / confirmed / cancelled).
  * `total_amount` – загальна сума замовлення.
  * `payment_status` – статус оплати (unpaid / partially_paid / paid).
  * `currency` – валюта (наприклад, USD, EUR, UAH).

**Обмеження:**

* `booking_id` – PK.
* `customer_id` – FK → `customers.customer_id`.
* Перевірка, що `total_amount >= 0` (ціна не може бути від’ємною).
* Перевірка, що `currency` входить у фіксований список (‘USD’, ‘EUR’, ‘UAH’).

---

### 2.7. Таблиця `tickets` – квитки

Описує конкретний квиток у рамках бронювання.

* **Основні поля:**

  * `ticket_id` – унікальний ID квитка (PK).
  * `booking_id` – FK на бронювання.
  * `flight_id` – FK на рейс.
  * `passenger_id` – FK на пасажира.
  * `seat_number` – місце в літаку (типу 12A).
  * `travel_class` – клас (economy, business, first).
  * `ticket_price` – ціна цього квитка (може відрізнятися від базової).
  * `ticket_status` – статус квитка (active, used, refunded, cancelled).

**Обмеження:**

* `ticket_id` – PK.
* `booking_id` – FK → `bookings.booking_id`.
* `flight_id` – FK → `flights.flight_id`.
* `passenger_id` – FK → `passengers.passenger_id`.
* Перевірка, що `ticket_price >= 0`.
* Унікальність комбінації `(flight_id, seat_number)` – одне й те саме місце на одному рейсі не може бути продано двом різним квиткам.

---

### 2.8. Таблиця `payments` – платежі

Зберігає інформацію про оплати за замовлення.

* **Основні поля:**

  * `payment_id` – унікальний ID платежу (PK).
  * `booking_id` – FK на бронювання, до якого належить платіж.
  * `payment_date` – дата й час платежу.
  * `amount` – сума платежу.
  * `payment_method` – спосіб (картка, PayPal, банківський переказ тощо).
  * `transaction_id` – ID транзакції в зовнішній платіжній системі.
  * `payment_status` – статус (success, failed, pending, refunded).
  * `currency` – валюта платежу.

**Обмеження:**

* `payment_id` – PK.
* `booking_id` – FK → `bookings.booking_id`.
* `transaction_id` – UNIQUE (одна транзакція платіжної системи не може фігурувати двічі).
* Перевірка, що `amount > 0`.
* Перевірка, що `currency` – одна з дозволених (‘USD’, ‘EUR’, ‘UAH’).

---

## 3. Зв’язки між таблицями (словами)

* **Один клієнт** (`customers`) може мати **багато пасажирів** (`passengers`).
* **Один клієнт** може зробити **багато бронювань** (`bookings`).
* **Одне бронювання** може містити **багато квитків** (`tickets`).
* **Один пасажир** може мати **багато квитків** на різні рейси.
* **Один рейс** (`flights`) має **багато квитків** (`tickets`).
* **Одна авіакомпанія** (`airlines`) виконує **багато рейсів** (`flights`).
* **Один аеропорт** використовується як точка вильоту чи прильоту для багатьох рейсів.
* **Одне бронювання** може мати **кілька платежів** (`payments`) – наприклад, часткова оплата.

---

## 4. Обмеження (constraints): короткий підсумок

1. **Первинні ключі (PK)**
   Є в кожній таблиці (`*_id` поля). Забезпечують унікальність рядків.

2. **Зовнішні ключі (FK)**
   Використовуються для зв’язків між таблицями:

   * `passengers.customer_id` → `customers.customer_id`
   * `flights.airline_id` → `airlines.airline_id`
   * `flights.departure_airport_id` / `arrival_airport_id` → `airports.airport_id`
   * `bookings.customer_id` → `customers.customer_id`
   * `tickets.booking_id` → `bookings.booking_id`
   * `tickets.flight_id` → `flights.flight_id`
   * `tickets.passenger_id` → `passengers.passenger_id`
   * `payments.booking_id` → `bookings.booking_id`

3. **UNIQUE-обмеження**

   * Унікальні коди авіакомпаній (`iata_code`, `icao_code`).
   * Унікальний код аеропорту (`iata_code`).
   * Унікальний `email` для клієнтів.
   * Унікальний `transaction_id` для платежів.
   * Унікальне поєднання `(airline_id, flight_number, departure_time)` для рейсів.
   * Унікальне поєднання `(flight_id, seat_number)` для квитків.

4. **CHECK-обмеження (перевірки)**

   * Різні аеропорти вильоту і прильоту для одного рейсу.
   * Ціни та суми не від’ємні.
   * Валюта – тільки з дозволеного списку.
   * Сума платежу > 0.

Це все відповідає вимогам цілісності та логіки предметної області.

---

## 5. Індекси – що і навіщо

Окрім первинних ключів та унікальних обмежень (вони автоматично створюють індекси), явно прописані додаткові індекси для прискорення типових запитів:

1. **Індекс на бронювання за клієнтом і датою:**

   * На таблиці `bookings` індекс по `(customer_id, booking_date)`.
   * Використовується, коли треба швидко знайти всі замовлення конкретного клієнта за період.

2. **Індекс на рейси за аеропортом вильоту і часом:**

   * На таблиці `flights` індекс по `(departure_airport_id, departure_time)`.
   * Корисний для пошуку рейсів типу: “усі вильоти з такого-то аеропорту в такому-то діапазоні часу”.

3. **Індекс квитків за рейсом:**

   * На таблиці `tickets` індекс по `flight_id`.
   * Прискорює запити “всі квитки на такий-то рейс”, наприклад для перевірки зайнятих місць.

4. **Індекс платежів за бронюванням:**

   * На таблиці `payments` індекс по `booking_id`.
   * Прискорює отримання всіх платежів по конкретному замовленню.

5. **Індекс пасажирів за клієнтом:**

   * На таблиці `passengers` індекс по `customer_id`.
   * Допомагає швидко отримати список усіх пасажирів, яких обслуговує даний клієнт.

